<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>QR Code Scanner</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f8f9fa;
    }
    .scanner-card {
      max-width: 600px;
      margin: 40px auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card scanner-card shadow-lg rounded-3">
      <div class="card-body">
        <h3 class="card-title mb-3 text-center">ðŸ“² QR Code Scanner</h3>
        
        <div class="mb-3">
          <label for="site" class="form-label">Site</label>
          <select id="site" class="form-select"></select>
        </div>
        
        <div class="mb-3">
          <label for="location" class="form-label">Location</label>
          <select id="location" class="form-select"></select>
        </div>

        <div class="mb-3">
          <label for="barcode" class="form-label">Scanned Barcode</label>
          <input type="text" id="barcode" class="form-control" placeholder="Scan or enter barcode here">
        </div>

        <button class="btn btn-primary w-100" onclick="openUserModal()">Submit</button>
      </div>
    </div>
  </div>

  <!-- User Name Modal -->
  <div class="modal fade" id="userModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Enter Your Name</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="text" id="userName" class="form-control" placeholder="Full Name">
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" onclick="submitScan()">Confirm</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Load dropdown values from Google Apps Script
    function loadDropdowns() {
      google.script.run.withSuccessHandler(function(data) {
        const siteSelect = document.getElementById("site");
        const locationSelect = document.getElementById("location");

        data.sites.forEach(s => {
          let opt = document.createElement("option");
          opt.value = s;
          opt.textContent = s;
          siteSelect.appendChild(opt);
        });

        data.locations.forEach(l => {
          let opt = document.createElement("option");
          opt.value = l;
          opt.textContent = l;
          locationSelect.appendChild(opt);
        });
      }).getDropdownData();
    }

    function openUserModal() {
      let barcode = document.getElementById("barcode").value.trim();
      if (!barcode) {
        alert("Please scan or enter a barcode first.");
        return;
      }
      let modal = new bootstrap.Modal(document.getElementById("userModal"));
      modal.show();
    }

    function submitScan() {
      const barcode = document.getElementById("barcode").value.trim();
      const userName = document.getElementById("userName").value.trim();
      const site = document.getElementById("site").value;
      const location = document.getElementById("location").value;

      if (!userName) {
        alert("Please enter your name.");
        return;
      }

      google.script.run.processScannedData(barcode, userName, site, location);

      alert("Scan submitted successfully!");
      document.getElementById("barcode").value = "";
      document.getElementById("userName").value = "";
    }

    window.onload = loadDropdowns;
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
